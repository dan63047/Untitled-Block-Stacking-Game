use bevy::{utils::HashMap, prelude::Color};
use lazy_static::lazy_static;

#[derive(Clone)]
pub enum LockDelayMode{
    Disabled,
    Gravity,
    ResetOnYChange,
    ResetOnMovementLimited,
    ResetOnMovement
}

#[derive(Clone)]
pub struct PiecesData {
    // X and Y from bottom left point (pieces[piece][rotation] = Vec of coords for Minos)
    pub pieces: Vec<Vec<Vec<(u8, u8)>>>,
    // X and Y shifts for pieces (kicks[piece][rotation before spin][direction of rotation] = Vec of points for tests)
    pub kicks: Vec<Vec<Vec<Vec<(i8, i8)>>>>,
    pub colours: Vec<Color>,
    // If spawn position is fucked, it fixes it
    pub spawn_offsets: Vec<(isize, isize)>,
    pub lock_delay_mode: LockDelayMode,
    // How high above field that piece should be spawned
    pub height_offset: isize,
}

lazy_static!{
    pub static ref ROTATION_SYSTEMS: HashMap<String, PiecesData> = {
        let mut rs = HashMap::new();
        rs.insert(String::from("SRS"), PiecesData{
            pieces: vec![
                vec![ // Z
                    vec![(0, 2), (1, 2), (1, 1), (2, 1)],
                    vec![(2, 2), (2, 1), (1, 1), (1, 0)],
                    vec![(2, 0), (1, 0), (1, 1), (0, 1)],
                    vec![(0, 0), (0, 1), (1, 1), (1, 2)]
                ],
                vec![ // J
                    vec![(0, 2), (0, 1), (1, 1), (2, 1)],
                    vec![(2, 2), (1, 2), (1, 1), (1, 0)],
                    vec![(2, 0), (2, 1), (1, 1), (0, 1)],
                    vec![(0, 0), (1, 0), (1, 1), (1, 2)]
                ],
                vec![ // I
                    vec![(0, 2), (1, 2), (2, 2), (3, 2)],
                    vec![(2, 3), (2, 2), (2, 1), (2, 0)],
                    vec![(3, 1), (2, 1), (1, 1), (0, 1)],
                    vec![(1, 0), (1, 1), (1, 2), (1, 3)]
                ],
                vec![ // T
                    vec![(1, 2), (0, 1), (1, 1), (2, 1)],
                    vec![(2, 1), (1, 2), (1, 1), (1, 0)],
                    vec![(1, 0), (2, 1), (1, 1), (0, 1)],
                    vec![(0, 1), (1, 0), (1, 1), (1, 2)]
                ],
                vec![ // O
                    vec![(0, 0), (0, 1), (1, 1), (1, 0)],
                ],
                vec![ // L
                    vec![(2, 2), (2, 1), (1, 1), (0, 1)],
                    vec![(2, 0), (1, 0), (1, 1), (1, 2)],
                    vec![(0, 0), (0, 1), (1, 1), (2, 1)],
                    vec![(0, 2), (1, 2), (1, 1), (1, 0)]
                ],
                vec![ // S
                    vec![(2, 2), (1, 2), (1, 1), (0, 1)],
                    vec![(2, 0), (2, 1), (1, 1), (1, 2)],
                    vec![(0, 0), (1, 0), (1, 1), (2, 1)],
                    vec![(0, 2), (0, 1), (1, 1), (1, 0)]
                ]
            ],
            kicks: vec![
                vec![ // Z
                    vec![
                        vec![( 0, 0),(-1, 0),(-1, 1),( 0,-2),(-1,-2)], // 0 -> 90
                        vec![( 0, 0),( 1, 0),( 1, 1),( 0,-2),( 1,-2)], // 0 -> 270
                        ],
                    vec![
                        vec![( 0, 0),( 1, 0),( 1,-1),( 0, 2),( 1, 2)], // 90 -> 180
                        vec![( 0, 0),( 1, 0),( 1,-1),( 0, 2),( 1, 2)], // 90 -> 0
                        ],
                    vec![
                        vec![( 0, 0),( 1, 0),( 1, 1),( 0,-2),( 1,-2)], // 180 -> 270
                        vec![( 0, 0),(-1, 0),(-1, 1),( 0,-2),(-1,-2)], // 180 -> 90
                        ], 
                    vec![
                        vec![( 0, 0),(-1, 0),(-1,-1),( 0, 2),(-1, 2)], // 270 -> 0
                        vec![( 0, 0),(-1, 0),(-1,-1),( 0, 2),(-1, 2)], // 270 -> 180
                        ] 
                ],
                vec![ // J
                    vec![
                        vec![( 0, 0),(-1, 0),(-1, 1),( 0,-2),(-1,-2)], // 0 -> 90
                        vec![( 0, 0),( 1, 0),( 1, 1),( 0,-2),( 1,-2)], // 0 -> 270
                        ],
                    vec![
                        vec![( 0, 0),( 1, 0),( 1,-1),( 0, 2),( 1, 2)], // 90 -> 180
                        vec![( 0, 0),( 1, 0),( 1,-1),( 0, 2),( 1, 2)], // 90 -> 0
                        ],
                    vec![
                        vec![( 0, 0),( 1, 0),( 1, 1),( 0,-2),( 1,-2)], // 180 -> 270
                        vec![( 0, 0),(-1, 0),(-1, 1),( 0,-2),(-1,-2)], // 180 -> 90
                        ], 
                    vec![
                        vec![( 0, 0),(-1, 0),(-1,-1),( 0, 2),(-1, 2)], // 270 -> 0
                        vec![( 0, 0),(-1, 0),(-1,-1),( 0, 2),(-1, 2)], // 270 -> 180
                        ] 
                ],
                vec![ // I
                    vec![
                        vec![( 0, 0),(-2, 0),( 1, 0),(-2,-1),( 1, 2)], // 0 -> 90
                        vec![( 0, 0),(-1, 0),( 2, 0),(-1, 2),( 2,-1)], // 0 -> 270
                        ],
                    vec![
                        vec![( 0, 0),(-1, 0),( 2, 0),(-1, 2),( 2,-1)], // 90 -> 180
                        vec![( 0, 0),( 2, 0),(-1, 0),( 2, 1),(-1,-2)], // 90 -> 0
                        ],
                    vec![
                        vec![( 0, 0),( 2, 0),(-1, 0),( 2, 1),(-1,-2)], // 180 -> 270
                        vec![( 0, 0),( 1, 0),(-2, 0),( 1,-2),(-2, 1)], // 180 -> 90
                        ],
                    vec![
                        vec![( 0, 0),( 1, 0),(-2, 0),( 1,-2),(-2, 1)], // 270 -> 0
                        vec![( 0, 0),(-2, 0),( 1, 0),(-2,-1),( 1, 2)], // 270 -> 180
                        ]
                ],
                vec![ // T
                    vec![
                        vec![( 0, 0),(-1, 0),(-1, 1),( 0,-2),(-1,-2)], // 0 -> 90
                        vec![( 0, 0),( 1, 0),( 1, 1),( 0,-2),( 1,-2)], // 0 -> 270
                        ],
                    vec![
                        vec![( 0, 0),( 1, 0),( 1,-1),( 0, 2),( 1, 2)], // 90 -> 180
                        vec![( 0, 0),( 1, 0),( 1,-1),( 0, 2),( 1, 2)], // 90 -> 0
                        ],
                    vec![
                        vec![( 0, 0),( 1, 0),( 1, 1),( 0,-2),( 1,-2)], // 180 -> 270
                        vec![( 0, 0),(-1, 0),(-1, 1),( 0,-2),(-1,-2)], // 180 -> 90
                        ], 
                    vec![
                        vec![( 0, 0),(-1, 0),(-1,-1),( 0, 2),(-1, 2)], // 270 -> 0
                        vec![( 0, 0),(-1, 0),(-1,-1),( 0, 2),(-1, 2)], // 270 -> 180
                        ] 
                ],
                vec![ // O
                    vec![
                        vec![( 0, 0)], // 0 -> 90
                        vec![( 0, 0)], // 0 -> 270
                        ],
                ],
                vec![ // L
                    vec![
                        vec![( 0, 0),(-1, 0),(-1, 1),( 0,-2),(-1,-2)], // 0 -> 90
                        vec![( 0, 0),( 1, 0),( 1, 1),( 0,-2),( 1,-2)], // 0 -> 270
                        ],
                    vec![
                        vec![( 0, 0),( 1, 0),( 1,-1),( 0, 2),( 1, 2)], // 90 -> 180
                        vec![( 0, 0),( 1, 0),( 1,-1),( 0, 2),( 1, 2)], // 90 -> 0
                        ],
                    vec![
                        vec![( 0, 0),( 1, 0),( 1, 1),( 0,-2),( 1,-2)], // 180 -> 270
                        vec![( 0, 0),(-1, 0),(-1, 1),( 0,-2),(-1,-2)], // 180 -> 90
                        ], 
                    vec![
                        vec![( 0, 0),(-1, 0),(-1,-1),( 0, 2),(-1, 2)], // 270 -> 0
                        vec![( 0, 0),(-1, 0),(-1,-1),( 0, 2),(-1, 2)], // 270 -> 180
                        ] 
                ],
                vec![ // S
                    vec![
                        vec![( 0, 0),(-1, 0),(-1, 1),( 0,-2),(-1,-2)], // 0 -> 90
                        vec![( 0, 0),( 1, 0),( 1, 1),( 0,-2),( 1,-2)], // 0 -> 270
                        ],
                    vec![
                        vec![( 0, 0),( 1, 0),( 1,-1),( 0, 2),( 1, 2)], // 90 -> 180
                        vec![( 0, 0),( 1, 0),( 1,-1),( 0, 2),( 1, 2)], // 90 -> 0
                        ],
                    vec![
                        vec![( 0, 0),( 1, 0),( 1, 1),( 0,-2),( 1,-2)], // 180 -> 270
                        vec![( 0, 0),(-1, 0),(-1, 1),( 0,-2),(-1,-2)], // 180 -> 90
                        ], 
                    vec![
                        vec![( 0, 0),(-1, 0),(-1,-1),( 0, 2),(-1, 2)], // 270 -> 0
                        vec![( 0, 0),(-1, 0),(-1,-1),( 0, 2),(-1, 2)], // 270 -> 180
                        ] 
                ],
            ],
            colours: vec![
                Color::RED,    // Z
                Color::Rgba { red: 0.0, green: 0.3, blue: 1.0, alpha: 1.0 },  // J
                Color::CYAN,   // I
                Color::Rgba { red: 1.0, green: 0.0, blue: 1.0, alpha: 1.0 },  // T
                Color::YELLOW, // O
                Color::ORANGE, // L
                Color::GREEN   // Z
            ],
            spawn_offsets: vec![
                (0,  0), // Z
                (0,  0), // J
                (0, -1), // I
                (0,  0), // T
                (1,  1), // O
                (0,  0), // L
                (0,  0)  // S
            ],
            lock_delay_mode: LockDelayMode::ResetOnMovementLimited,
            height_offset: 0,
        });
        rs.insert(String::from("NRS"), PiecesData {
            pieces: vec![
                vec![ // Z
                    vec![(0, 1), (1, 1), (1, 0), (2, 0)],
                    vec![(2, 2), (2, 1), (1, 1), (1, 0)],
                ],
                vec![ // J
                    vec![(2, 0), (2, 1), (1, 1), (0, 1)],
                    vec![(0, 0), (1, 0), (1, 1), (1, 2)],
                    vec![(0, 2), (0, 1), (1, 1), (2, 1)],
                    vec![(2, 2), (1, 2), (1, 1), (1, 0)],
                ],
                vec![ // I
                    vec![(3, 1), (2, 1), (1, 1), (0, 1)],
                    vec![(2, 3), (2, 2), (2, 1), (2, 0)],
                ],
                vec![ // T
                    vec![(1, 0), (2, 1), (1, 1), (0, 1)],
                    vec![(0, 1), (1, 0), (1, 1), (1, 2)],
                    vec![(1, 2), (0, 1), (1, 1), (2, 1)],
                    vec![(2, 1), (1, 2), (1, 1), (1, 0)],
                ],
                vec![ // O
                    vec![(0, 0), (0, 1), (1, 1), (1, 0)],
                ],
                vec![ // L
                    vec![(0, 0), (0, 1), (1, 1), (2, 1)],
                    vec![(0, 2), (1, 2), (1, 1), (1, 0)],
                    vec![(2, 2), (2, 1), (1, 1), (0, 1)],
                    vec![(2, 0), (1, 0), (1, 1), (1, 2)],
                ],
                vec![ // S
                    vec![(0, 0), (1, 0), (1, 1), (2, 1)],
                    vec![(2, 0), (2, 1), (1, 1), (1, 2)],
                ]
            ],
            kicks: vec![
                vec![ // Z
                    vec![vec![( 0, 0)], vec![( 0, 0)]],
                    vec![vec![( 0, 0)], vec![( 0, 0)]],
                ],
                vec![ // J
                    vec![vec![( 0, 0)], vec![( 0, 0)]],
                    vec![vec![( 0, 0)], vec![( 0, 0)]],
                    vec![vec![( 0, 0)], vec![( 0, 0)]],
                    vec![vec![( 0, 0)], vec![( 0, 0)]],
                ],
                vec![ // I
                    vec![vec![( 0, 0)], vec![( 0, 0)]],
                    vec![vec![( 0, 0)], vec![( 0, 0)]],
                ],
                vec![ // T
                    vec![vec![( 0, 0)], vec![( 0, 0)]],
                    vec![vec![( 0, 0)], vec![( 0, 0)]],
                    vec![vec![( 0, 0)], vec![( 0, 0)]],
                    vec![vec![( 0, 0)], vec![( 0, 0)]],
                ],
                vec![ // O
                    vec![vec![( 0, 0)], vec![( 0, 0)]],
                ],
                vec![ // L
                    vec![vec![( 0, 0)], vec![( 0, 0)]],
                    vec![vec![( 0, 0)], vec![( 0, 0)]],
                    vec![vec![( 0, 0)], vec![( 0, 0)]],
                    vec![vec![( 0, 0)], vec![( 0, 0)]],
                ],
                vec![ // S
                    vec![vec![( 0, 0)], vec![( 0, 0)]],
                    vec![vec![( 0, 0)], vec![( 0, 0)]],
                ],
            ],
            colours: vec![
                Color::RED,    // Z
                Color::Rgba { red: 0.0, green: 0.3, blue: 1.0, alpha: 1.0 },  // J
                Color::CYAN,   // I
                Color::Rgba { red: 1.0, green: 0.0, blue: 1.0, alpha: 1.0 },  // T
                Color::YELLOW, // O
                Color::ORANGE, // L
                Color::GREEN   // Z
            ],
            spawn_offsets: vec![
                (0,  0), // Z
                (0,  0), // J
                (0,  0), // I
                (0,  0), // T
                (1,  0), // O
                (0,  0), // L
                (0,  0)  // S
            ],
            height_offset: -2,
            lock_delay_mode: LockDelayMode::Gravity 
        });
        rs
    };
}